
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../../build/other/gcc%E7%BC%96%E8%AF%91%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/">
      
      
        <link rel="next" href="../GStreamer-pipeline-example-with-thead-omxil-lib/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.1.21">
    
    
      
        <title>GStreamer Player Porting - RevyOS Docs</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.eebd395e.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#adaptation-documentation-for-gstreamer-player-supporting-ptg-omxil-library" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../" title="RevyOS Docs" class="md-header__button md-logo" aria-label="RevyOS Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            RevyOS Docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              GStreamer Player Porting
            
          </span>
        </div>
      </div>
    </div>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m12.87 15.07-2.54-2.51.03-.03A17.52 17.52 0 0 0 14.07 6H17V4h-7V2H8v2H1v2h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04M18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12m-2.62 7 1.62-4.33L19.12 17h-3.24Z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="../../../adaptation/GStreamer%E6%92%AD%E6%94%BE%E5%99%A8%E9%80%82%E9%85%8D/" hreflang="zh" class="md-select__link">
                    简体中文
                  </a>
                </li>
              
                <li class="md-select__item">
                  <a href="./" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
              
            </ul>
          </div>
        </div>
      </div>
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/revyos/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    revyos/docs
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../" class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../build/debian/enable_optimization_gcc/" class="md-tabs__link">
        Build
      </a>
    </li>
  

  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="./" class="md-tabs__link md-tabs__link--active">
        Porting Docs
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../desktop/revyos-use-docker/" class="md-tabs__link">
        System Usage
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../benchmark/coremark/" class="md-tabs__link">
        benchmark
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../Installation/licheepi4a/" class="md-tabs__link">
        Installation
      </a>
    </li>
  

      
        
  
  


  
  
  
    

  
  
  
    <li class="md-tabs__item">
      <a href="../../changelog/lpi4a/20240601/" class="md-tabs__link">
        Changelog
      </a>
    </li>
  

  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../" title="RevyOS Docs" class="md-nav__button md-logo" aria-label="RevyOS Docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    RevyOS Docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/revyos/docs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    revyos/docs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Build
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Build
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          Debian
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          Debian
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/debian/enable_optimization_gcc/" class="md-nav__link">
        Enable Optimization GCC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/debian/Debian%E8%BD%AF%E4%BB%B6%E5%8C%85%E6%9E%84%E5%BB%BA%E6%B5%81%E7%A8%8B/" class="md-nav__link">
        Debian Software Package Build Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/debian/%E7%BC%96%E8%AF%91%E5%99%A8%E7%9B%B8%E5%85%B3%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        Compiler Related Description
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          Other Builds
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          Other Builds
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/other/thead-qemu%E7%BC%96%E8%AF%91%E6%B5%81%E7%A8%8B/" class="md-nav__link">
        T-Head QEMU Build Process
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/other/manuel_build_kernel/" class="md-nav__link">
        Manuel Build Kernel
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../build/other/gcc%E7%BC%96%E8%AF%91%E8%BD%AF%E4%BB%B6%E8%AF%B4%E6%98%8E/" class="md-nav__link">
        GCC Tips
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Porting Docs
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Porting Docs
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          GStreamer Player Porting
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        GStreamer Player Porting
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-gstreamer-omxh264dec-decoding-test" class="md-nav__link">
    A. GStreamer omxh264dec Decoding Test
  </a>
  
    <nav class="md-nav" aria-label="A. GStreamer omxh264dec Decoding Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-driver-compilation-installation-and-hardware-access-permissions" class="md-nav__link">
    1. Driver Compilation, Installation, and Hardware Access Permissions
  </a>
  
    <nav class="md-nav" aria-label="1. Driver Compilation, Installation, and Hardware Access Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-compile-drivers" class="md-nav__link">
    1.1 Compile Drivers
  </a>
  
    <nav class="md-nav" aria-label="1.1 Compile Drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-alternative-solution" class="md-nav__link">
    1.1.1 Alternative Solution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-install-drivers" class="md-nav__link">
    1.2 Install Drivers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-set-hardware-access-permissions" class="md-nav__link">
    1.3 Set Hardware Access Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-record" class="md-nav__link">
    RevyOS Adaptation Record
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-vpu-omxil-and-adjust-configuration" class="md-nav__link">
    2. Install vpu-omxil and Adjust Configuration
  </a>
  
    <nav class="md-nav" aria-label="2. Install vpu-omxil and Adjust Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-register-components-in-vpu-omxil-with-libomxil-bellagio" class="md-nav__link">
    2.1 Register Components in vpu-omxil with libomxil-bellagio
  </a>
  
    <nav class="md-nav" aria-label="2.1 Register Components in vpu-omxil with libomxil-bellagio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-revyosdebian-component-registration" class="md-nav__link">
    2.1.1 RevyOS/Debian Component Registration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-configure-gstomxconf" class="md-nav__link">
    2.2 Configure gstomx.conf
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-dmabuf-patch" class="md-nav__link">
    3. Add dmabuf Patch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-initial-gstreamer-decoding-test" class="md-nav__link">
    4. Initial GStreamer Decoding Test
  </a>
  
    <nav class="md-nav" aria-label="4. Initial GStreamer Decoding Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-compatibility-notes" class="md-nav__link">
    RevyOS Compatibility Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-choosing-the-right-gstreamer-video-sink" class="md-nav__link">
    B. Choosing the Right GStreamer video-sink
  </a>
  
    <nav class="md-nav" aria-label="B. Choosing the Right GStreamer video-sink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-notes" class="md-nav__link">
    RevyOS Adaptation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-player-support" class="md-nav__link">
    C. Player Support
  </a>
  
    <nav class="md-nav" aria-label="C. Player Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-notes_1" class="md-nav__link">
    RevyOS Adaptation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-revyos-adaptation-work" class="md-nav__link">
    Summary of RevyOS Adaptation Work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-used" class="md-nav__link">
    Resources Used
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../GStreamer-pipeline-example-with-thead-omxil-lib/" class="md-nav__link">
        GStreamer Pipeline Example
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          System Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          System Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/revyos-use-docker/" class="md-nav__link">
        Docker
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/install/" class="md-nav__link">
        Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Software Usage
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Software Usage
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/software/gimp/" class="md-nav__link">
        GIMP Image Editor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/software/iBus/" class="md-nav__link">
        iBus Input Method
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/software/ROS2/" class="md-nav__link">
        ROS2
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Games
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Games
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/games/OpenTTD%E6%B8%B8%E6%88%8F/" class="md-nav__link">
        OpenTTD Game
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../desktop/games/yquake2/" class="md-nav__link">
        yquake2 Game
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          benchmark
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          benchmark
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/coremark/" class="md-nav__link">
        coremark
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/stream/" class="md-nav__link">
        stream
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/reboot/" class="md-nav__link">
        reboot-test
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/lmbench/" class="md-nav__link">
        lmbench
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/glmark2/" class="md-nav__link">
        glmark2
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../benchmark/p7zip/" class="md-nav__link">
        p7zip
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Installation/licheepi4a/" class="md-nav__link">
        Lichee Pi 4A
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Installation/milkv-pioneer/" class="md-nav__link">
        Milk-V Pioneer
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          Changelog
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Changelog
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_1" >
      
      
      
        <label class="md-nav__link" for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
          lpi4a
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          lpi4a
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20240601/" class="md-nav__link">
        20240601
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20240202/" class="md-nav__link">
        20240202
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20231210/" class="md-nav__link">
        20231210
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20231026/" class="md-nav__link">
        20231026
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230916/" class="md-nav__link">
        20230916
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230810/" class="md-nav__link">
        20230810
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230614/" class="md-nav__link">
        20230614
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230511/" class="md-nav__link">
        20230511
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230425/" class="md-nav__link">
        20230425
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/lpi4a/20230412/" class="md-nav__link">
        20230412
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" >
      
      
      
        <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
          ahead
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          ahead
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../changelog/ahead/20230802/" class="md-nav__link">
        20230802
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-gstreamer-omxh264dec-decoding-test" class="md-nav__link">
    A. GStreamer omxh264dec Decoding Test
  </a>
  
    <nav class="md-nav" aria-label="A. GStreamer omxh264dec Decoding Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-driver-compilation-installation-and-hardware-access-permissions" class="md-nav__link">
    1. Driver Compilation, Installation, and Hardware Access Permissions
  </a>
  
    <nav class="md-nav" aria-label="1. Driver Compilation, Installation, and Hardware Access Permissions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#11-compile-drivers" class="md-nav__link">
    1.1 Compile Drivers
  </a>
  
    <nav class="md-nav" aria-label="1.1 Compile Drivers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#111-alternative-solution" class="md-nav__link">
    1.1.1 Alternative Solution
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-install-drivers" class="md-nav__link">
    1.2 Install Drivers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-set-hardware-access-permissions" class="md-nav__link">
    1.3 Set Hardware Access Permissions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-record" class="md-nav__link">
    RevyOS Adaptation Record
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-install-vpu-omxil-and-adjust-configuration" class="md-nav__link">
    2. Install vpu-omxil and Adjust Configuration
  </a>
  
    <nav class="md-nav" aria-label="2. Install vpu-omxil and Adjust Configuration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21-register-components-in-vpu-omxil-with-libomxil-bellagio" class="md-nav__link">
    2.1 Register Components in vpu-omxil with libomxil-bellagio
  </a>
  
    <nav class="md-nav" aria-label="2.1 Register Components in vpu-omxil with libomxil-bellagio">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#211-revyosdebian-component-registration" class="md-nav__link">
    2.1.1 RevyOS/Debian Component Registration
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-configure-gstomxconf" class="md-nav__link">
    2.2 Configure gstomx.conf
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-add-dmabuf-patch" class="md-nav__link">
    3. Add dmabuf Patch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-initial-gstreamer-decoding-test" class="md-nav__link">
    4. Initial GStreamer Decoding Test
  </a>
  
    <nav class="md-nav" aria-label="4. Initial GStreamer Decoding Test">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-compatibility-notes" class="md-nav__link">
    RevyOS Compatibility Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#b-choosing-the-right-gstreamer-video-sink" class="md-nav__link">
    B. Choosing the Right GStreamer video-sink
  </a>
  
    <nav class="md-nav" aria-label="B. Choosing the Right GStreamer video-sink">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-notes" class="md-nav__link">
    RevyOS Adaptation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#c-player-support" class="md-nav__link">
    C. Player Support
  </a>
  
    <nav class="md-nav" aria-label="C. Player Support">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#revyos-adaptation-notes_1" class="md-nav__link">
    RevyOS Adaptation Notes
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary-of-revyos-adaptation-work" class="md-nav__link">
    Summary of RevyOS Adaptation Work
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#resources-used" class="md-nav__link">
    Resources Used
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="adaptation-documentation-for-gstreamer-player-supporting-ptg-omxil-library">Adaptation Documentation for GStreamer Player Supporting PTG omxil Library</h1>
<p>Applicable SDK v1.1.2</p>
<h2 id="overview">Overview</h2>
<p>PTG's OpenMAX IL library (<code>vpu-omxil</code>) enables the LicheePi 4A to smoothly perform hardware decoding for 4K 60fps video playback. This document details the integration and usage of the Parole player on the LicheePi 4A development board, providing a guide to the adaptation process on this platform. The workflow for hardware decoding, using H.264 as an example, is shown below.</p>
<pre><code class="language-plain">                +-------------------------------------------+
                |    +------------+       +------------+    |   +--------+
video stream----+---&gt;| omxh264dec +------&gt;| video-sink +----+--&gt;| player |
                |    +------+-----+       +------------+    |   +--------+
                |           |     GStreamer                 |
                +-----------+-------------------------------+
                            |
                      +-----v-----+
                      | vpu-omxil |
                      +-----+-----+
                            |
                            |
                    +-------v-------+
                    | kernel module |
                    |    (driver)   |
                    +-------+-------+
                            |
                            v
                        hardware
</code></pre>
<ol>
<li>The video stream is read into GStreamer, processed, and sent to the <code>omxh264dec</code> decoder in GStreamer.</li>
<li><code>omxh264dec</code> invokes PTG's <code>vpu-omxil</code> library, which accesses the hardware through the driver (kernel module) for hardware decoding.</li>
<li>The decoded stream is then passed to GStreamer's video sink and rendered by the player.</li>
</ol>
<h2 id="a-gstreamer-omxh264dec-decoding-test">A. GStreamer omxh264dec Decoding Test</h2>
<p>To isolate the <code>omxh264dec</code> decoding component, the general structure is as follows:</p>
<pre><code class="language-plain">  +---+------------+----+
  |   +------------+    |
  |   | omxh264dec |    |
  |   +------------+    |
  |      GStreamer      |
  +----------+----------+
             |
  +----+-----v-----+----+
  |    +-----------+    |
  |    | vpu-omxil |    |
  |    +-----------+    |
  |  libomxil-bellagio  |
  +----------+----------+
             |
+------------v------------+
|  - memalloc   - vc8000  |
|  - hantrodec  - vidmem  |
|      kernel modules     |
+------------+------------+
             |
             v
          hardware
</code></pre>
<p>This section focuses on enabling the <code>omxh264dec</code> decoder, without involving screen output.</p>
<h3 id="1-driver-compilation-installation-and-hardware-access-permissions">1. Driver Compilation, Installation, and Hardware Access Permissions</h3>
<p>To enable hardware decoding, drivers must be compiled and installed to access the hardware.</p>
<h4 id="11-compile-drivers">1.1 Compile Drivers</h4>
<p>PTG-provided driver sources:</p>
<ul>
<li><a href="https://github.com/revyos/vpu-vc8000e-kernel">vpu-vc8000e-kernel</a></li>
<li><a href="https://github.com/revyos/vpu-vc8000d-kernel">vpu-vc8000d-kernel</a></li>
<li><a href="https://github.com/revyos/video_memory">video_memory</a></li>
</ul>
<h5 id="111-alternative-solution">1.1.1 Alternative Solution</h5>
<p>The <a href="https://github.com/revyos/thead-kernel">revyos/thead-kernel</a> has merged the above modules, so you may avoid compiling these if using <code>revyos_defconfig</code>.</p>
<h4 id="12-install-drivers">1.2 Install Drivers</h4>
<pre><code class="language-shell"># Use depmod to analyze dependencies and create modules.dep in /lib/modules/&lt;kernel-version&gt;.
sudo depmod -a
sudo modprobe vidmem vc8000 hantrodec memalloc

# If modprobe fails, try using insmod
# cd /usr/lib/modules/$(uname -r)
# sudo insmod $(find . -name *vidmem.ko*)
# sudo insmod $(find . -name *vc8000.ko*)
# sudo insmod $(find . -name *hantrodec.ko*)
# sudo insmod $(find . -name *memalloc.ko*)

# Optional: Load modules at boot
echo -e &quot;\nvidmem\nhantrodec\nmemalloc\nvc8000\n&quot; | sudo tee -a /etc/modules &gt; /dev/null
</code></pre>
<h4 id="13-set-hardware-access-permissions">1.3 Set Hardware Access Permissions</h4>
<p>After installing kernel modules, device files for <code>hantrodec</code>, <code>vidmem</code>, and <code>vc8000</code> will appear in <code>/dev</code>. By default, users lack access permissions, so non-root users will encounter errors when opening the omxil library.</p>
<pre><code class="language-shell"># For one-time effect
cd /dev
sudo chmod 666 hantrodec vidmem vc8000

# For persistent effect
cat &lt;&lt; EOF | sudo tee /lib/udev/rules.d/70-hantro.rules &gt; /dev/null
KERNEL==&quot;vidmem&quot;, MODE=&quot;0666&quot;
KERNEL==&quot;hantrodec&quot;, MODE=&quot;0666&quot;
KERNEL==&quot;vc8000&quot;, MODE=&quot;0666&quot;
EOF
</code></pre>
<h4 id="revyos-adaptation-record">RevyOS Adaptation Record</h4>
<p>For RevyOS-specific kernel modules, go to <a href="https://github.com/revyos/thead-kernel">revyos/thead-kernel</a> and download artifacts from GitHub CI.</p>
<h3 id="2-install-vpu-omxil-and-adjust-configuration">2. Install <code>vpu-omxil</code> and Adjust Configuration</h3>
<p>First, download and extract <code>vpu-omxil</code> to <code>/usr/lib/omxil/</code>.
<a href="https://drive.google.com/file/d/1pYgCVI7WltfpskltJ-RqzVUCEC21FS56">Download vpu-omxil_1.2.1.tar.gz</a></p>
<p>As illustrated below, the following steps are required:</p>
<ol>
<li>Register the OpenMax components in <code>vpu-omxil</code> with <code>libomxil-bellagio</code>.</li>
<li>Configure <code>gst-omx</code> (which provides the <code>omxh264dec</code> decoder) to recognize the component names when calling <code>libomxil-bellagio</code>.</li>
</ol>
<pre><code class="language-plain">+---------+   +-------------------+   +-----------+
| gst-omx +--&gt;| libomxil-bellagio +--&gt;| vpu-omxil |
+---------+   +-------------------+   +-----------+
</code></pre>
<h4 id="21-register-components-in-vpu-omxil-with-libomxil-bellagio">2.1 Register Components in <code>vpu-omxil</code> with <code>libomxil-bellagio</code></h4>
<pre><code class="language-shell">sudo apt install libomxil-bellagio-bin libomxil-bellagio0
# Register components
omxregister-bellagio -v /usr/lib/omxil/
</code></pre>
<p>The registration file is generated by <code>omxregister-bellagio</code> and, by default, is located at <code>~/.omxregister</code>.</p>
<h5 id="211-revyosdebian-component-registration">2.1.1 RevyOS/Debian Component Registration</h5>
<p><a href="https://github.com/revyos/th1520-vpu">th1520-vpu</a> utilizes Debian’s automatic registration process in <code>/usr/lib/riscv64-linux-gnu/libomxil-bellagio0</code> upon installation. The resulting registry appears as follows:</p>
<pre><code class="language-bash">cat /var/lib/libomxil-bellagio0/registry
/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.H2.video.encoder.so
 ==&gt; OMX.hantro.H2.video.encoder ==&gt; OMX.hantro.H2.video.encoder.avc:OMX.hantro.H2.video.encoder.hevc:
/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.VC8000D.image.decoder.so
 ==&gt; OMX.hantro.VC8000D.image.decoder ==&gt; OMX.hantro.VC8000D.image.decoder.jpeg:
/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.H2.image.encoder.so
 ==&gt; OMX.hantro.H2.image.encoder ==&gt; OMX.hantro.H2.image.encoder.jpeg:
/usr/lib/riscv64-linux-gnu/libomxil-bellagio0/libOMX.hantro.VC8000D.video.decoder.so
 ==&gt; OMX.hantro.VC8000D.video.decoder ==&gt; OMX.hantro.VC8000D.video.decoder.mpeg4:OMX.hantro.VC8000D.video.decoder.avc:OMX.hantro.VC8000D.video.decoder.avs:OMX.hantro.VC8000D.video.decoder.h263:OMX.hantro.VC8000D.video.decoder.wmv:OMX.hantro.VC8000D.video.decoder.vp6:OMX.hantro.VC8000D.video.decoder.vp8:OMX.hantro.VC8000D.video.decoder.jpeg:OMX.hantro.VC8000D.video.decoder.hevc:OMX.hantro.VC8000D.video.decoder.vp9:OMX.hantro.VC8000D.video.decoder.avs2:
</code></pre>
<h4 id="22-configure-gstomxconf">2.2 Configure <code>gstomx.conf</code></h4>
<p>Adjust the <code>gstomx.conf</code> settings to ensure the <code>omxh264dec</code> decoder calls the correct components. See the following patch for <code>gst-omx</code> configuration details:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-gst-omx-01-add-libomxil-config-patch">gst-omx-01-add-libomxil-config.patch</a></p>
<h3 id="3-add-dmabuf-patch">3. Add <code>dmabuf</code> Patch</h3>
<p>Please refer to the <code>dmabuf</code> patch for <code>gst-omx</code> provided by PTG:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-gst-omx-02-set-dec-out-port-dmabuf-patch">gst-omx-02-set-dec-out-port-dmabuf.patch</a></p>
<h3 id="4-initial-gstreamer-decoding-test">4. Initial GStreamer Decoding Test</h3>
<pre><code class="language-shell">sudo apt install gstreamer1.0-omx-generic gstreamer1.0-omx-bellagio-config gstreamer1.0-plugins-bad gstreamer1.0-plugins-base gstreamer1.0-gl gstreamer1.0-plugins-good gstreamer1.0-tools

# 1. Basic decoding
gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fakesink  sync=false
# 2. Display FPS in the terminal
# Reference: https://stackoverflow.com/questions/73948308
gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fpsdisplaysink video-sink=fakesink  text-overlay=false sync=false -v 2&gt;&amp;1
</code></pre>
<p><code>fakesink</code> discards all incoming video frames, bypassing the <code>video-sink</code> rendering stage to avoid performance loss, while <code>fpsdisplaysink</code> provides decoding speed statistics. Sample log output:</p>
<pre><code class="language-log">Setting pipeline to PAUSED ...[DBGT]
vc8kdec compiled without trace support (ENABLE_DBGT_TRACE switch not enabled)
Pipeline is PREROLLING ...
Redistribute latency...
OMX  ! decoder_get_parameter OMX_ErrorNoMore (2)
Pipeline is PREROLLED ...
Setting pipeline to PLAYING ...
New clock: GstSystemClockRedistribute latency...
0:01:39.5 / 0:01:49.4 (90.9 %)
</code></pre>
<p><strong>Tip:</strong> If encountering errors such as <code>[omxh264dec-omxh264dec0: Could not initialize supporting library.](https://gist.github.com/Sakura286/015fae6792e160268db7ad8a697dd2df)</code>, consider installing the debug-symbol packages for <code>gst-omx</code>, <code>libomxil-bellagio</code>, and <code>libc6</code>. Use <code>gdb</code> to troubleshoot by running the command above, setting a breakpoint at <code>DWLInit</code> and <code>open</code> to pinpoint where the issue arises.</p>
<h4 id="revyos-compatibility-notes">RevyOS Compatibility Notes</h4>
<p>During the RevyOS adaptation process, the following issues were identified as causes for dynamic library initialization failures:</p>
<ol>
<li>Incompatible toolchain used when compiling <code>vpu-omxil</code>.</li>
<li>Missing <code>vpu-omxil</code> registration with <code>omxregister-bellagio</code>.</li>
<li>Insufficient permissions for <code>/dev</code> devices <code>hantrodec</code>, <code>vc8000</code>, and <code>vidmem</code>.</li>
</ol>
<h2 id="b-choosing-the-right-gstreamer-video-sink">B. Choosing the Right GStreamer <code>video-sink</code></h2>
<p>The <code>video-sink</code> is the last step in the <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/concepts.html">GStreamer pipeline</a>, handling the final output of the video stream to the screen.
In the tests above, <code>fakesink</code> served as a testing <code>video-sink</code> to verify decoder functionality. There are, however, many <code>video-sink</code> options available (<a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/platform-specific-elements.html?gi-language=c">see list</a>), such as <code>autovideosink</code>, <code>ximagesink</code>, <code>xvimagesink</code>, <code>fbdevsink</code>, <code>waylandsink</code>, <code>glimagesink</code>, <code>gtkglsink</code>, each requiring specific installation packages as follows:</p>
<table>
<thead>
<tr>
<th><strong>video-sink</strong></th>
<th><strong>Package</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td>waylandsink</td>
<td>gstreamer1.0-plugins-bad</td>
</tr>
<tr>
<td>fbdevsink</td>
<td>gstreamer1.0-plugins-bad</td>
</tr>
<tr>
<td>autovideosink</td>
<td>gstreamer1.0-plugins-good</td>
</tr>
<tr>
<td>gtkglsink</td>
<td>gstreamer1.0-plugins-good</td>
</tr>
<tr>
<td>ximagesink &#124; xvimagesink</td>
<td>gstreamer1.0-plugins-base</td>
</tr>
<tr>
<td>glimagesink</td>
<td>gstreamer1.0-plugins-base &#124; gstreamer1.0-gl</td>
</tr>
</tbody>
</table>
<p><strong>Tip:</strong> Use <code>gst-inspect-1.0 &lt;video-sink-name&gt;</code> to view available options for each <code>video-sink</code>.
<strong>Tip:</strong> Adjust <code>--gst-debug-level=&lt;lv&gt;</code> to set the <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/debugging-tools.html#the-debug-log">debug log level</a>, where <code>&lt;lv&gt;</code> ranges from 1 to 6, with higher levels providing more verbose output. Setting the level below 4 is recommended, as higher levels can result in very long logs.
Experiment with different <code>video-sink</code> options, plugin parameters, and environmental variables until you find one that enables smooth H.264 hardware decoding.</p>
<h3 id="revyos-adaptation-notes">RevyOS Adaptation Notes</h3>
<ul>
<li><strong>waylandsink</strong>: As RevyOS is currently (20230720) using the Xfce desktop environment, Wayland support is not feasible, so <code>waylandsink</code> is inherently unusable.</li>
<li><strong>fbdevsink</strong> and <strong>ximagesink</strong>: Both are unusable.</li>
<li><strong>xvimagesink</strong>: From <a href="https://gstreamer.freedesktop.org/documentation/tutorials/basic/debugging-tools.html#getting-pipeline-graphs">pipeline graphs</a> and logs, we can see that <code>playbin</code> or <code>autovideosink</code> automatically calls <code>xvimagesink</code>. After analyzing with <code>perf</code>, it’s evident that <code>xvimagesink</code> involves significant <code>memcpy</code> operations, severely impacting decoding performance. This issue persists even with the PTG-provided <code>dmabuf</code> patch, so it’s not a viable option.</li>
<li><strong>gtkglsink</strong>: Due to <a href="https://gitlab.gnome.org/GNOME/gtk/-/issues/738">GTK3’s lack of support for EGL on X11</a>, and as RevyOS is based on X11 and only supports EGL, this option is also unusable.</li>
</ul>
<p>The only remaining option is <code>glimagesink</code>. Based on <a href="https://gstreamer.freedesktop.org/documentation/gstreamer/running.html#environment-variables">Running and debugging GStreamer Applications</a> and examples that use <code>glimagesink</code>, it appears necessary to specify the environment variables <code>GST_GL_API</code> and <code>GST_GL_PLATFORM</code>. Since RevyOS uses a <code>gles2</code> + <code>egl</code> setup, the following command enables successful hardware decoding:</p>
<pre><code class="language-shell">GST_GL_API=gles2 GST_GL_PLATFORM=egl gst-launch-1.0 filesrc location=&lt;test.mp4&gt; ! qtdemux !  h264parse ! omxh264dec  ! videoconvert ! fpsdisplaysink video-sink=glimagesink sync=false
</code></pre>
<p>However, these parameters cannot be passed as environment variables when GStreamer is invoked by a media player. Therefore, it’s essential to pass additional <code>meson</code> build options when compiling <code>gst-plugins-base</code>:</p>
<pre><code class="language-shell">-Dgl_api=[\'gles2\'] -Dgl_platform=[\'egl\']
</code></pre>
<h2 id="c-player-support">C. Player Support</h2>
<p>Once the GStreamer pipeline functions correctly, the next step is to enable player support. Different players utilize different <code>video-sink</code> elements and have varying levels of dependency on GStreamer. The adaptation strategy for players is to either (1) modify the player to support the verified <code>video-sink</code> or (2) modify the GStreamer pipeline to support the player’s specified <code>video-sink</code>. The RevyOS adaptation process adopts the first approach.</p>
<pre><code class="language-plain">                +-------------------------------------------+
                |    +------------+       +------------+    |   +--------+
video stream----+---&gt;| omxh264dec +------&gt;| video-sink +----+--&gt;| player |
                |    +------------+       +------------+    |   +--------+
                |                GStreamer                  |
                +-------------------------------------------+
</code></pre>
<h3 id="revyos-adaptation-notes_1">RevyOS Adaptation Notes</h3>
<p>Based on the <a href="https://gstreamer.freedesktop.org/apps/">GStreamer-supported applications list</a>:</p>
<table>
<thead>
<tr>
<th>Usable</th>
<th>Updated</th>
<th>Application</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>❌</td>
<td></td>
<td>Gnash</td>
<td>Flash Player</td>
</tr>
<tr>
<td>❌</td>
<td></td>
<td>GEntrans</td>
<td>Not in Debian</td>
</tr>
<tr>
<td>❓</td>
<td>20230226</td>
<td>Kaffeine</td>
<td>❌ Requires extensive KDE dependencies</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>✔️ Present in the <a href="https://buildd.debian.org/status/package.php?p=kaffeine&amp;suite=sid">riscv64 repository</a></td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>❌ On Debian amd64 Gnome, the playback and control windows are separated, with VLC as the default player.</td>
</tr>
<tr>
<td>❌</td>
<td></td>
<td>Lcdgrilo</td>
<td>Not in Debian</td>
</tr>
<tr>
<td>✔️</td>
<td>20230218</td>
<td>Parole</td>
<td>✔️ For XFCE</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>❓ No Wayland support, X11 only</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>✔️ Verified on Debian amd64 Gnome</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>✔️ Available in the <a href="https://buildd.debian.org/status/package.php?p=parole&amp;suite=sid">riscv64 repository</a></td>
</tr>
<tr>
<td>❌</td>
<td></td>
<td>Songbird</td>
<td>Not in Debian</td>
</tr>
<tr>
<td>❌</td>
<td></td>
<td>Snappy</td>
<td>Not in Debian</td>
</tr>
<tr>
<td>❌</td>
<td></td>
<td>Totem</td>
<td>Requires GTK3, which doesn’t support EGL on X11</td>
</tr>
</tbody>
</table>
<p>Totem was initially chosen but proved difficult to support due to its inability to specify a <code>video-sink</code> other than <code>gtkglsink</code>, which RevyOS does not support. After evaluating GStreamer-compatible players, Parole emerged as a suitable choice. Parole, written with GObject, requires modification in the <code>parole_gst_constructed</code> method to set <code>video-sink</code> to <code>glimagesink</code>, as previously validated. The patch can be found here:</p>
<p><a href="https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca#file-parole-01-add-glimagesink-support-patch">parole-01-add-glimagesink-support.patch</a></p>
<p>With this, the preliminary adaptation work is complete.</p>
<h2 id="summary-of-revyos-adaptation-work">Summary of RevyOS Adaptation Work</h2>
<ol>
<li>Compile driver modules into the kernel, enable them at boot, and set device permissions.</li>
<li>Package PTG's <code>omxil</code> binary dynamic library files as <code>th1520-vpu</code>.</li>
<li>Modify <code>th1520-vpu</code> dependencies to require <code>gst-omx</code>, <code>libomxil-bellagio</code>, etc.</li>
<li>Add post-install operations, such as registering components with <code>omxregister-bellagio</code>.</li>
<li>Modify <code>gst-omx</code>:</li>
<li>Add support for the <code>vpu-omxil</code> component in the config.</li>
<li>Apply <code>dmabuf</code> patches.</li>
<li>Add support for h265 and vp9.</li>
<li>Modify <code>gst-base</code> to limit GL support to <code>gles2</code> + <code>egl</code> during compilation.</li>
<li>Modify Parole to support <code>glimagesink</code>.</li>
</ol>
<h2 id="resources-used">Resources Used</h2>
<p>Patch collection:</p>
<p>https://gist.github.com/Sakura286/26777ea8204c1819885e093806a4f7ca</p>
<p>PTG omxil library:</p>
<p>https://drive.google.com/file/d/1pYgCVI7WltfpskltJ-RqzVUCEC21FS56</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.tabs", "navigation.tabs.sticky"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="https://cdnjs.loli.net/ajax/libs/pangu/4.0.7/pangu.min.js"></script>
        
      
        
          <script src="../../../_static/js/extra.js"></script>
        
      
    
  </body>
</html>